name: oidc-authservice 
summary: Arrikto's oidc-authservice in a ROCK.
description: "TODO"
version: "0.0.1"
base: ubuntu:22.04
license: Apache-2.0
cmd: ["/bin/oidc-authservice"]
platforms:
  amd64:
parts:
  oidc-authservice:
    plugin: go
    source: https://github.com/arrikto/oidc-authservice
    source-type: git
    source-tag: master
    build-snaps:
      - go
    build-environment:
      - BUILD_IN_CONTAINER: "false"
    override-build: |
      CGO_ENABLED=0 GOOS=linux go build -a -ldflags '-extldflags "-static"' -o bin/oidc-authservice
      install -D -m755 bin/oidc-authservice ${CRAFT_PART_INSTALL}/opt/oidc-authservice/bin/oidc-authservice
      cp -R web ${CRAFT_PART_INSTALL}/opt/oidc-authservice/web 
    organize:
      opt/oidc-authservice/bin/oidc-authservice: usr/bin/oidc-authservice
      opt/oidc-authservice/web: web
